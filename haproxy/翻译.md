# Hello HAProxy
HA监听过来的请求并且将这些请求转发到一些特定的server上去。一旦你的访问量上去了，那么此时你需要添加新的server来处理这些请求。发出请求的客户端永远都不需要关心服务端到底有多少台机器，又或者换另外的别的方式来访问服务端。相反HA使得整个的多个server表现起来像一台server一样。

<br>
当你的网站或者服务背后有多台服务器来支撑的时候，那么此时你需要处理越来越多的网络交通。此时整个集群中的每台机器被称为节点。那么当你的服务是由多个节点的机器组成的服务的时候，那么此时你对集群中的某个节点做升级部署更新等服务的时候，就不会导致整个服务受到影响。

# 什么是HA
* HA是一个软件包
* HA表现的就像是一个控制反转的代理
* HA是针对于TCP请求的应用的负载均衡器

## TCP请求的应用
客户端和服务器端通过TCP协议来提交数据。

## reverse proxy
反转代理，顾名思义，就是在你的真实处理请求的后端服务器之前，接收从客户端发送过来的请求的代理服务器。它就是一个虚拟的服务的代理者。任何人可以在任何地方访问代理服务器，然后代理服务器根据客户端的请求，将请求转发给server处理，继而接受服务端给予的响应再将响应转回给客户端。
这样带来的好处是：
* 客户端永远无法直接与服务端进行会话
* 匿名性和安全性
* 可以选择在代理端做一些事情

## load balancer
load balancer负责将过来的请求分发至不同的节点上。它一直管理着上一次请求是哪个server来处理的，以及接下来过来的请求要计划分配给哪个server进行处理。同时，LB负责监控当前情况下已连接的client是与哪个server保持联系，目的是为了让server将响应发送给正确的客户端。


所以HA既是Reverse Proxy，也是LB。它坐落在客户端与你的服务器集群之间，代理过来的请求以及相应的将请求转发给对应的服务器。

# HA是怎样工作的
 HA使用一个单线程single-thread，基于事件驱动的event-driven的架构设计来接收客户端的请求，并且将请求转发给后端的server。转发之后它不会在那里一直等待着server给予反馈和响应，相反它转发完一个请求的时候接着去转发处理另外一个请求，什么时候返回？服务端处理完成之后会调用回调函数，那么当HA收到一个回调的时候才会返回，继而将响应返回给客户端。此时针对于该请求的处理才算完成。基于这样的设计，HA可以扩容去同时处理数以千万计的请求。

<br>
对比其他web server例如tomcat和IIS,它们的设计是针对于每个过来的请求都开一个单独的线程，同时还要负责维护这个线程在整个服务器-客户端的会话中存活。当请求量较小的时候，性能还凑合，当请求量较大的时候，那么此时web server的性能就会出现下降，因为要同时处理多个任务。

<br>
对于HA来说，HA可以通过增加节点的方式来扩容后端的服务，这就好比给予后端更多的资源去做更多的事情。这是分布式计算系统的核心和灵魂。这被称为水平扩展或者扩容horizontal scaling and scaling out.
